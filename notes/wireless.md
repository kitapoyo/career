# Wireless
1. [基礎知識](#anchor1)
   - 電波と電磁波
   - 周波数 ( Hz )
   - 電波干渉 ( Interference )
   - 電波の種類
   - 電波の大きさ ( dB )
   - スペクトラムアナライザ
2. [変調方式](#anchor2)
   - AM ( Amplitude Modulation ：振幅変調 ) 方式
   - FM ( Frequency Modulation ：周波数変調 ) 方式
   - PM ( Phase Modulation ：位相変調 ) 方式
   - ２次変調
3. [無線技術](#anchor3)
   - MIMO ( Multi Input Multi Output )
   - ビームフォーミング
   - IEEE 802.11ac
   - CSMA / CA ( Carrier Sence Multiple Access with Collision Avoidance )
   - RTS / CTS 方式
   - IFS ( Inter Frame Space )
4. [無線 LAN 接続の順序](#anchor4)
5. [無線 LAN セキュリティ](#anchor5)
   - ANY 接続禁止機能 ( ステルス SSID )
   - MAC アドレスフィルタリング


<a id="anchor1"></a>

## 1. 基礎知識

### 電波と電磁波
 - 電波は電磁波とも呼ばれ、電気と磁力の性質を持ち合わせます。<br>そのため、電気をよく通す金属は **電波の反射** が発生します。<br>また、電気を通さない木などは **電波が通過** します。<br>このように、電波は物質に対して反射または通過 ( 屈折 ) するという性質があります。
 - **フレミングの左手の法則** により、電流 ( 電界) と磁場 ( 磁界 ) は直角に交わります。
    - 中指：I ( 電流 )
    - 人差し指 ：B ( 磁場 )
    - 親指：F ( 力の向き )
 - **アンペールの右ねじの法則** により、親指の指す方向に電流の向きがあります。

#### 無線の仕組み
1. アンテナに電流を流すと、右ねじの法則により磁界 ( N , S の磁場 ) が発生
2. 磁界が発生すると、フレミングの左手の法則により、磁界と垂直に電界が発生
3. 発生した電界により磁場が発生
4. これを光の速さで繰り返すことでリング状の電界と磁界が発生 ( これが電波 )
   - 電波の速度はおよそ **１秒間で３０万 km** , 時速１０億８０００万 km ( 地球７周半 )

### 周波数 ( Hz )
 - １秒間に繰り返す波の数です。

    ```:公式
    周波数 = 電波の速度 / 波長 ( 波長 = 電波の速度 / 周波数 )
    ```

 - **波長** とは、山の頂上から次の山の頂上までに１つの波が進む距離です。
 - 周波数は単一ではなく、伝送する内容によって開きがあり、それが **周波数帯域** と言います。<br>電波の周波数を表す際は、周波数帯域の真ん中を使用した **中心周波数** で表します。
 - 周波数が高い電波は **直進性** が強く、音のように周波数が低い電波は **回り込む** 性質が強くなります。

### 電波干渉 ( Interference )
 - 周波数が近い２つ以上の電波が付近にあると、**お互いを強めたり弱めたりする現象** です。
 - 同じ周波数の電波を受信して、それらの電波を区別できない現象を **電波の混信** と呼びます。
 - 目的の周波数 ( x ) と付近の周波数 ( y ) とし、整数 m , n で以下の周波数にノイズが発生します。

    ```:公式
    mx ± ny
    ```
 - 同一チャンネルでは、別の SSID と **20dB ( 100倍 ) 以上** の差があれば、干渉問題は気にしなくても大丈夫です。

### 電波の種類
 - 3THz 以下のものは **電磁波** です。
 - 3THz 以上のものは **光** です。
 - 400THz ~ 800THz のものは **可視光線** です。
 - 10000THz 以上のものは **放射線** です。

|名称|周波数|波長|特徴|
|---|---|---|---|
|中波<br>Medium Frequency|300kHz ~ 3MHz|1km ~ 100m|AM ラジオ|
|短波<br>High Frequency|3MHz ~ 30MHz|100m ~ 10m|アマチュア無線|
|超短波<br>Very High Frequency|30MHz ~ 300MHz|10m ~ 1m|アナログテレビ放送|
|極超短波<br>Ultra High Frequency|300MHz ~ 3GHz|1m ~ 10cm|無線 LAN 2.4GHz 帯<br>地表での反射で衰退<br>水分子を効率よく吸収 ( 電子レンジ )|
|マイクロ波<br>Super High Frequency|3GHz ~ 30GHz|10cm ~ 1cm|無線 LAN 5GHz 帯<br>波長が短く直進性が高い<br>衛星放送, レーダー|
|ミリ波<br>Extremely High Frequency|30GHz ~ 300GHz|1cm ~ 1mm|１秒間の波が非常に多いため、多くの情報を送信<br>空港などの全身スキャナー|

### 電波の大きさ ( dB )
 - 送信装置からアンテナに供給される電力を **空中線電力** と呼び、**電流と電圧を乗じた電力 ( W )** で表します。
 - 無線 LAN の電力は電波法で制限され、1MHz あたり 1.25mW ~ 10mW で送信することが定められています。
 - 電波の強さは、基準をあらかじめ定め、その基準に対して大小を対数 ( log ) で表す ( ベル B ) を単位とします。<br>この値を１０倍した **デシベル ( dB )** という単位で表すのが普通です。
    - 電波の場合は、基準が **1mW** なので **dBm** となります。

    ```:公式
    電波の強さ ( dBm ) = 10 * log10 { 対象の電波の強さ ( mW ) / 基準 1 ( mW ) }
    ```

### スペクトラムアナライザ
 - 電波の強さを測定して **電波の見える化** を行う装置です。
 - 横軸に **周波数 ( Hz )** と縦軸に **電力 ( dB )** が表示され、電波の形を周波数で分解して表示します。
 - その瞬間における周波数ごとの利用状況や外来派のノイズを確認することができます。

<a id="anchor2"></a>

## 2. 変調方式

### AM ( Amplitude Modulation ：振幅変調 ) 方式
 - データを送るための特定の周波数 ( 以後 **搬送波** ) に音声信号を足し合わせて電波の振幅を変化させる方式です。
 - AM ラジオやアナログテレビで使用されています。
 - 搬送波の大きな山の両側に **側帯波** と呼ばれる同じサイズの小さな波が表示されます。

### FM ( Frequency Modulation ：周波数変調 ) 方式
 - 搬送波の周波数を音声の周波数に合わせて変化させる方式です。
 - AM 方式よりも広い側帯波が表示されます。

### PM ( Phase Modulation ：位相変調 ) 方式
 - 送信するデータに応じて搬送波の ` 角度 ( θ ：シータ ) = 位相 ( θ ：シータ ) ` をずらす方式です。
 - 位相 ( Phase ) の変化を変調に用いるため **位相偏移変調 ( PSK ：Phase Shift Keying )** とも呼ばれます。
 - デジタル信号を送信するのに適した変調方式です。

#### シータ ( θ )
 - 搬送波は円弧を描いた周期的な形となるため、180 度 を π ( パイ ) としたラジアンで表記します。
 - 周波数の波は θ ( π ) が 0 から 2 まで変化する間に波が進む距離を波長と言います。

### ２次変調
 - 無線 LAN でデータを送信する場合は以下の変調処理を行います。
1. コンピュータが扱う 0 と 1 のデータをキャリア ( 搬送波 ) に乗せて通信するための **変調波** に変えます。
    - 01 データを送信すると、多くの場合ノイズや符号誤りが発生してしまうためです。
    - この処理は **デジタル変調** と呼ばれ、**１次変調** とも呼ばれています。
2. デジタル変調された信号 ( 変調信号 ) を複数の周波数で利用するためにマルチキャリア伝送処理を行います。
    - この処理を **２次変調** と呼びます。
    - スペクトラム拡散 ( Spread Spectrum ) などいくつかの方法で処理を行います。
 - デジタル符号化とマルチキャリア伝送方式の組み合わせを **MCS ( Modulation and Coding Scheme )** と呼びます。

|２次変調|概要|スペクトラム形状|用途|
|---|---|---|---|
|FHSS<br>( Frequency Hopping Spread Spectrum)|短い単位で異なる周波数に切り替えて通信|切り替える周波数を覆う長方形|Bluetooth|
|DSSS<br>( Direct Sequence Spread Spectrum )|拡散符号を用いて変調波を乗算し、<br>広い周波数に信号を拡散|中心周波数を中央とした椀型|IEEE 802.11b<br>ビデオカメラ|
|OFDM<br>( Orthogonal Frequency Division Multiplexing )|変調波を４８個のサブキャリアに分解して、<br>異なる周波数で送受信|中心周波数を中央とした長方形|IEEE 802.11a<br>IEEE 802.11g<br>IEEE 802.11n<br>ADSL<br>地デジ|

<a id="anchor3"></a>

## 3. 無線技術

### MIMO ( Multi Input Multi Output )
 - 複数のアンテナおよびチャネルを使用して、かつ同一チャネルで同時通信を行う技術です。
 - 拡張した MU - MIMO ( Multi User Multi Input Multi Output ) では、アクセスポイントが複数の端末と<br>異なるチャンネルで同時に通信することができます。

### ビームフォーミング
 - 端末からの応答パケットの信号強度などに応じて、同一チャネルの信号を水平方向や垂直方向にずらして送信する仕組みです。
 - 電波の届きにくい場所に設置されている端末でも安定して通信を行うことができます。

### IEEE 802.11ac
 - 5GHz 帯を使用します。
 - 20, 40, 60, 80, 160MHz の帯域を使用して、最大 20MHZ × 8CH の MIMO が可能です。
 - 基準の 20MHz チャネルをプライマリチャネルとし、通信チャネルを増減することで帯域幅の拡大や縮小ができます。
 - ガードインターバルを 800ns から 400ns に短縮することが可能です。

### CSMA / CA ( Carrier Sence Multiple Access with Collision Avoidance ：搬送波感知多重アクセス / 衝突回避 )
 - 端末が通信する際に、衝突を避けながら任意にアクセスする仕組みです。**MAC ( Media Access Control )** とも呼びます。
 - 無線 LAN での CSMA /CA の **帯域利用率は 30 ％ 程度** になってしまいます。
1. 他の端末が該当チャンネルに信号を出していないことを **( Carrier Sence ：搬送波検知 )** で確認します。
    - 他の端末が送信するプリアンブルを検出することで、他の通信を感知します。
    - 他の通信の制御・管理パケットを受信して、信号の大きさ ( dB ) の閾値によって信号が流れているか判断します。
2. 信号が流れていない場合、その時点で選択可能な符号化や伝送処理 ( MCS ) を選択して送信します。
3. データパケットを受信したアクセスポイントは、正しく受信したことを示す ( ACK ：確認応答 ) を送信元に即座に返します。
    - 送信側に設定した時間内に ACK を受信できない場合は、一定時間後に再度パケットを送信します。<br>**( DCF ：Distributed Coordination Function )**
    - ACK の送信元アドレスを空欄にすることで、少しでも早く ACK を返すような機器も存在します。
 - インフラストラクチャーモードでは **PCF ( Point Coordination Function )** も使用することができます。
    - アクセスポイントがポーリングを行って各端末の通信を集中的に制御する仕組みです。

### RTS / CTS 方式
 - 無線 LAN 送信制御技術の１つです。CSMA /CA よりオーバーヘッドが大きくなるため、原則使用はされません。
 - RTS ( Request To Send ：送信要求 ) とは、端末がアクセスポイントに対して送信要求を求めるパケットです。
 - CTS ( Clear To Send ：送信可能 ) とは、端末がデータ送信可能であることを伝えるパケットです。
1. 端末はアクセスポイントに対して RTS を送信します。
2. アクセスポイントが RTS を受信すると、他の通信の終了を待ちます。
3. 通信が可能になったら CTS を端末に送信します。

### IFS ( Inter Frame Space )
 - パケットを送信する前に空ける時間です。優先度に応じて４種類存在します。<br>IFS が短ければ早くパケットを送信することができます。
1. SIFS ( Short IFS )
    - ACK パケットなどで使用されます。
2. PIFS ( PCF IFS )
    - ポーリングの制御に使用されます。
3. DIFS ( DCF IFS )
    - データパケットなどで使用されます。
4. EIFS ( Extended IFS )
    - 輻輳を防ぐために拡張された IFS です。
    - ` EIFS = SIFS + ACK パケットの送信時間 + DIFS ` で算出されます。

<a id="anchor4"></a>

## 4. 無線 LAN 接続の順序

|順序|パケットの種類|方向|説明|
|---|---|---|---|
|1|ビーコン|アクセスポイント<br>→ブロードキャスト|アクセスポイントが SSID や通信方式などを通知|
|2|プローブ要求|端末<br>→アクセスポイント|端末が全てのアクセスポイント宛に通信規格や速度を指定して調査|
|3|プローブ応答|アクセスポイント<br>→端末|プローブ要求に該当したアクセスポイントが端末の調査に対して、<br>通信速度や対応規格などを通知|
|4|認証|端末<br>→アクセスポイント|端末がアクセスポイントに対して、オープンシステム認証と SSID の確認を実施|
|5|認証|アクセスポイント<br>→端末|アクセスポイントが端末に対して、オープンシステム認証と SSID の確認を実施|
|6|アソシエーション要求|端末<br>→アクセスポイント|端末からアクセスポイントに対して、データリンク確立のアソシエーションを要求|
|7|アソシエーション応答|アクセスポイント<br>→端末|アクセスポイントが端末に対して、アソシエーション許可を応答<br>ここでデータリンクが確立|
|8|データパケット|端末<br>→ブロードキャスト ( DHCP )|アソシエーションで確立したデータリンクで通信|

<a id="anchor5"></a>

## 5. 無線 LAN セキュリティ

### ANY 接続禁止機能 ( ステルス SSID )
 - 無線 LAN 端末がプローブ要求を送信する際に **SSID を空欄** にすると、エリア内のアクセスポイント一覧を取得できます。<br>**ANY 接続機能**
 - アクセスポイントがプローブ要求の SSID を確認し、 **any または空欄** のプローブ要求には応じないようにします。<br>これが **ANY 接続禁止機能 ( ステルス SSID )** です。
 - しかし、キャプチャ ( 盗聴 ) 等で、端末やアクセスポイントから流れる管理パケットなどで SSID は知られてしまします。

### MAC アドレスフィルタリング
 - 接続を許可する端末の MAC アドレスをアクセスポイントに登録し、登録した端末のみ通信を許可する方法です。
 - アクセスポイントに接続する端末が少ない場合や、アクセスポイントが１つのみの場合に有効です。
 - しかし、**MAC アドレスは比較的簡単に偽造することができます。**<br>また、WPA2 の TKIP / AES などでも MAC アドレスは暗号化されません。
