# ディスククォータ管理
1. ディスククォータ とは
2. クォータ管理
    - quota インストール
    - マウントオプションの指定
    - クォータの有効化
    - 制限値を設定
    - クォータの確認
    - ユーザー設定のコピー

## 1. ディスククォータ とは
 - ユーザー単位またはグループ単位でディスクの使用量を制限する仕組みで、ファイルシステム単位で設定します。<br>使用量は、サイズと i ノード数で指定できます。
 - 制限値には以下の３つがあります。
1. ハードリミット：これ以上書き込めない制限値
2. ソフトリミット：超えると警告が出る制限値
3. 猶予期限：ソフトリミットを超えていられる期限。期限が過ぎるとハードリミットになります。

## 2. クォータ管理
 - マウントポイント **/data** に対して制限をする例で記述していきます。

### quota インストール

 ```:コマンド
 sudo apt -y install quotatool
 ```

### マウントオプションの指定
1. 対象のファイルシステムがマウント中なら、一度アンマウントします。

    ```:コマンド
    sudo umount /dev/sdb1
    ```

2. ユーザー単位で制限する場合は **usrquota** , グループ単位で制限する場合は **grpquota** を設定します。<br>また、両方同時に指定できます。

    ```:コマンド
    sudo mount -o usrquota /dev/sdb1 /data
    ```

 - **/etc/fstab** に記述する場合<br>` /dev/sdb1 /data ext4 defaults,usrquota 0 0 `

### クォータの有効化
1. ディスククォータを初めて実行する場合は、クォータデータベースを初期化します。

    ```:コマンド
    sudo quotacheck -um /data
    ```

2. クォータを有効化

    ```:コマンド
    sudo quotaon -uv /data
    ```

### 制限値を設定
 - 例として、ユーザー **hoge** にソフトリミット２G、ハードリミット３Gを設定します。

    ```:コマンド
    sudo edquota hoge
    ```
 - ユーザー **hoge** の設定を、ユーザー **hoge2** にコピーする場合<br>` sudo edquota -p hoge hoge2 `

### クォータの確認

 ```:コマンド
 sudo repquota -a
 ```
