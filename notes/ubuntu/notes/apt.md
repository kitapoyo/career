# APT ( Advanced Packaging Tool )
1. [概要](#anchor1)
2. [APT ( Advanced Packaging Tool ) とは](#anchor2)
3. [apt コマンド](#anchor3)
   - 書式
   - オプション
   - サブコマンド
   - システムアップデート
   - パッケージ情報のインデックスを更新
   - アップデートされるパッケージを表示
   - システムを更新
   - パッケージのインストール
   - パッケージの削除
   - パッケージの一覧
   - パッケージの検索
   - パッケージ情報の表示
4. [リポジトリ](#anchor4)
   - リポジトリの設定
   - /etc/apt/sources.list ファイル
   - リポジトリの公開鍵
   - リポジトリの削除
5. [add-apt-repository コマンド](#anchor5)
   - 書式
6. [apt-file](#anchor6)
   - インストール
   - 書式
   - オプション
   - アクション
   - パッケージ情報の更新

<a id="anchor1"></a>

## 1. 概要
 - Linux では、パッケージという単位でソフトウェアを管理します。
 - Debian 系のパッケージ管理には **dpkg** というコマンドがありますが、管理が難しいです。

<a id="anchor2"></a>

## 2. APT ( Advanced Packaging Tool ) とは
 - Debian 系ディストリビューションで使用されるパッケージ管理システムです。
 - 依存関係を自動的に調整しながら、パッケージのインストール・アップデート・削除を行います。
 - あらかじめ設定されたリポジトリからパッケージとパッケージの情報を取得します。
 - リポジトリには、Ubuntu 公式に加え、サードパーティのリポジトリも多々公開されています。

<a id="anchor3"></a>

## 3. apt コマンド

### 書式
 - オプションの位置はサブコマンドの後でも可能です。

    ```:コマンド
    apt [ オプション ] サブコマンド
    ```

### オプション

|オプション|説明|
|---|---|
|-c < 設定ファイル >|設定ファイルを指定します。<br>デフォルトは **/etc/apt/sources.list** です。|
|-d|パッケージのダウンロードのみ行います。|
|-y|問い合わせに対して自動で YES を選択します。|
|--no-install-recommends|必須ではない推奨パッケージはインストールしません。|
|--install-suggests|提案パッケージもインストールします。|
|--reinstall|インストール済みパッケージの再インストールを許可します。|

### サブコマンド
|サブコマンド|説明|
|----|----|
|update|パッケージリストを更新する ( パッケージそのものは更新されない )|
|install < パッケージ名 >|パッケージをインストールする|
|remove < パッケージ名 >|パッケージを削除する ( 設定ファイルは残る )|
|purge < パッケージ名 >|パッケージを完全に削除する|
|full-upgrade|パッケージの削除に伴い、システムを最新にアップデートする|
|show < パッケージ名 >|指定したパッケージに関する情報を表示する|
|list|パッケージリストを表示する|
|list --installed|インストールされたパッケージ一覧を表示する|
|list --upgradable|アップデート可能なパッケージ一覧を表示する|
|search|指定したキーワードでパッケージ情報を全文検索する|
|depends < パッケージ名 >|パッケージの依存関係を表示する|
|autoremove|必要とされていないパッケージを自動的に削除する|

### システムアップデート
 - アップデートが存在する場合は、ログイン時に以下のようなメッセージが表示されます。
 - **security updates** が存在する場合は、速やかにアップデートしましょう。

    ```:表示例
    11 packages can be updated.
    0 updates are security updates.
    ```

### パッケージ情報のインデックスを更新

 ```:コマンド
 sudo apt -y update
 ```

### アップデートされるパッケージを表示

 ```:コマンド
 sudo apt list --upgradable
 ```

### システムを更新

 ```:コマンド
 sudo apt -y upgrade
 ```

### パッケージのインストール

 ```:コマンド
 apt install パッケージ名
 ```

### パッケージの削除

 ```:コマンド
 sudo apt remove パッケージ名
 ```

### パッケージの一覧
 - インストールされているパッケージは **installed** , 依存関係で自動的にインストールされたパッケージは **installed,automatic** と表示されます。

    ```:コマンド
    apt list [ パッケージ名 ]
    ```

 - ワイルドカードを使用して表示させることもできます。

    ```:コマンド
    apt list "apache2*"
    ```

### パッケージの検索

 ```:コマンド
 apt search パッケージ名
 ```

### パッケージ情報の表示

 ```:コマンド
 apt show パッケージ名
 ```

<a id="anchor4"></a>

## 4. リポジトリ

### リポジトリの設定
 - リポジトリの追加は **add-apt-repository** コマンドを使用します。
 - 以下のファイルで設定します。
1. **/etc/apt/sources.list**
2. **/etc/apt/sources.list.d/** 以下の **.list** ファイル

### /etc/apt/sources.list ファイル
 - １行につき、１つのリポジトリを記述します。

    ```:表示例
    deb http://jp.archive.ubuntu.com/ubuntu bionic-security main restricted
      ⓵                            ⓶                                ③                    ④
    ```

1. **deb** であれば**パッケージ取得** , **deb-src** なら**ソースパッケージの取得**
2. 取得先の起点となる URL
3. Ubuntu のバージョン名
4. コンポーネント<br>**main** ：Canonical がサポートするフリーなオープンソースソフトウェア<br>**restricted** ：プロプライエタリ ( 専用の , 独自の ) なソフトウェア ( 主にデバイスドライバー )<br>**universe** ：コミュニティによってメンテナンスされるフリーなオープンソースソフトウェア<br>**multiverse** ：著作権もしくは法的な問題で制限されたソフトウェア

### リポジトリの公開鍵
 - APT では、公開鍵認証を使用して安全性を高めています。以下のコマンドで確認できます。

    ```:コマンド
    sudo apt-key list
    ```

### リポジトリの削除
 - **ppa-purge** パッケージを使用します。デフォルトではインストールされておりません。
 - インストールコマンド

    ```:コマンド
    sudo apt -y install ppa-purge
    ```

 - 削除コマンド

    ```:コマンド
    ppa-purge リポジトリ
    ```

<a id="anchor5"></a>

## 5. add-apt-repository コマンド
 - 公式に扱われていないソフトウェアを利用するのに便利ですが、セキュリティに注意して使用しましょう。
 - **PPA** を登録すると **apt upgrade** の対象になります。
 - 追加されたリポジトリ情報は **/etc/apt/sources.list.d/** ディレクトリ以下に格納されます。

### 書式
 - リポジトリ名は **ppa:ユーザー名 / PPA 名** で指定します。

    ```:コマンド
    add-apt-repository リポジトリ
    ```

 - OpenJDK  リポジトリを追加する場合

    ```:コマンド
    sudo add-apt-repository ppa:openjdk-r/ppa
    ```

 - ` ls /etc/apt/sources.list.d/ `

    ```:コマンド結果
    openjdk-r-ubuntu-ppa-bionic.list
    ```

<a id="anchor6"></a>

## 6. apt-file
 - 特定のファイルを含むパッケージを検索する際に使用します。
 - 必要なファイルは分かるが、パッケージ名がわからない場合などに重宝します。

### インストール

 ```:コマンド
 sudo apt -y install apt-file
 ```

### 書式

 ```:コマンド
 apt-file [ オプション ] アクション [ パターン ]
 ```

### オプション

|オプション|説明|
|----|----|
|-F|パターンと完全一致したものだけを表示します。|
|-i|大文字と小文字を区別しません。|
|-x|パターンを正規表現とみなします。|

### アクション

|アクション|説明|
|----|----|
|update|パッケージ情報を同期する|
|search , find|パッケージに含まれるファイル名で検索する|
|list , show|パッケージ内のファイルを表示する|
|purge|キャッシュファイルを削除する|

### パッケージ情報の更新

 ```:コマンド
 sudo apt-file update
 ```

 - /usr/bin/sudo ファイルを含むパッケージを検索する場合

    ```:コマンド
    apt-file search /usr/bin/sudo
    ```

 - 完全一致の場合

    ```:コマンド
    apt-file -F search /usr/bin/sudo
    ```
