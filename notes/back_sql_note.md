# SQL ( Structured Query Language ) Note
1. [用語](#anchor1)
2. [NULL](#anchor2)
   - NULL 対応 ( COALESCE )
3. [SELECT](#anchor3)
4. [エイリアス ( 別名 )](#anchor4)
5. [WHERE](#anchor5)
6. [比較演算子](#anchor6)
   - BINARY
7. [論理演算子](#anchor7)
8. [データ型](#anchor8)
9. [データの型変換 ( CAST )](#anchor9)
10. [グループ化 ( GROUP BY )](#anchor10)
11. [並び替え ( ORDER BY )](#anchor11)
12. [行数指定 ( LIMIT )](#anchor12)
13. [条件 ( CASE )](#anchor13)
14. [関数](#anchor14)
15. [重複の削除 ( DISTINCT )](#anchor15)
16. [問い合わせ](#anchor16)
    - 副問い合わせの結果から NULL を除外する場合
    - 副問い合わせの複数結果
    - 相関副問い合わせ
17. [テーブルの結合](#anchor17)
    - UNION
    - JOIN ( INSERT JOIN )

<a id="anchor1"></a>

## 1. 用語
 - リレーショナルデータベース ( 関係データベース：RDB ) の表現

    |用語|意味|備考|
    |---|---|---|
    |レコード|行||
    |カラム|列||
    |フィールド|テーブル内の１要素||
    |予約語|SQLの中で特別な役割を持つ単語|SELECT , FROM etc<br>予約語はアルファベットで表現し大文字で書く|

<a id="anchor2"></a>

## 2. NULL
 - **NULL** とは、データが存在しないことです。
 - **IS NULL** で**NULL** を取得する条件を指定できます。
 - **<=>** 以外の演算子で **NULL** を対象にすると結果はすべて **NULL** になります。
 - 算術演算子においても **NULL** を指定して計算すると **NULL** になります。

### NULL 対応 ( COALESCE )
 - **COALESCE** 関数を使用すると **NULL** の値を置き換えることができます。

    ```:書式
     COALESCE( カラム名, 0)
    ```

<a id="anchor3"></a>

## 3. SELECT
 - データを所得するために、**「 なに 」を「 どこ 」から取得するかを書きます。**
 - **SELECT** の後に **\*** を書くとテーブルにあるすべてのカラムの内容を取得します。
 - **FROM** を書かない **SELECT** も存在します。

    ```:書式
    SELECT
        カラム１ ,
        カラム２
    FROM
        テーブル名 ;
    ```

<a id="anchor4"></a>

## 4. エイリアス ( 別名 )
 - カラムやテーブル名に対して別名を定義します。
 - データを取得する際は **AS** を使用します。

    ```:書式
    SELECT
        id AS 商品番号,
        name AS 商品名
    FROM
        list AS 在庫表 ;
    ```

<a id="anchor5"></a>

## 5. WHERE
 - データを検索する際などに、**条件の指定ができます。**
 - **WHERE** 句は **SELECT FROM** の後に続けて書きます。

    ```:書式
    SELECT
        カラム１ ,
        カラム２
    FROM
        テーブル名
    WHERE 条件 ;
    ```

<a id="anchor6"></a>

## 6. 比較演算子
 - **指定した条件に対して値を返します。**<br>**1 => True** ：**条件に当てはまる**<br>**0 => False** ：**条件に当てはまらない**<br>**NULL** ：**特殊な場合で条件に当てはまらない**
 - 演算子には優先順位があります。最優先は **( )** で囲ったものです。

### BINARY
 - 厳密に文字列検索をしたい場合は **BINARY** を使用します。
 - 比較演算子を使用して文字列を検索すると下記のような問題があるためです。
1. **大文字小文字を区別しない**
2. **末尾の半角スペースが無視される**
 - カラムから 'A' と一致するレコードを取得する場合

    ```:書式
    SELECT * FROM テーブル名 WHERE カラム = BINARY 'A';
    ```

    |演算子|書き方|意味|
    |---|---|---|
    |=| A = B|AとBは等しい|
    |<=>| A <=> B|AとBは等しい(NULLに対応)|
    |!=| A != B|AとBは異なる|
    |<>| A <> B|AとBは異なる|
    |<| A < B|AはBより小さい|
    |>| A > B|AはBより大きい|
    |<=| A <= B|AはB以下|
    |=>| A => B|AはB以上|
    |%|A%|任意の０文字以上の文字<br>AAA,ABC,Abc|
    |\_|A\_|任意の１文字<br>AA,AB,Ab|
    |IS NULL| A IS NULL|AはNULL|
    |IS NOT NULL| A IS NOT NULL|AはNULLではない|
    |IS| A IS |AはTRUE|
    |IS NOT| A IS NOT|AはFALSE|
    |LIKE| A LIKE B |AはBに一致する(大文字小文字は区別しない)|
    |LIKE| A NOT LIKE B |AはBに一致しない(大文字小文字は区別しない)|
    |BETWEEN|BETWEEN A AND B|A以上B以下の場合|
    |NOT BETWEEN|NOT BETWEEN A AND B|A以上B以下でない場合|
    |IN|IN (A,B,C)|A,B,C のいずれかに一致する場合|
    |NOT IN|NOT IN (A,B,C)|A,B,C のいずれかに一致しない場合|

<a id="anchor7"></a>

## 7. 論理演算子

|名称|演算子|書き方|意味|
|---|---|---|---|
|論理積|AND<br>&&|A AND B<br>A && B|A と B が両方１の場合のみ True|
|論理和|OR<br>|\|\|A OR B<br>A \|\| B|A と B のどちらか片方が１であれば True|
|否定|NOT<br>!|NOT A<br>!A| A が０の場合のみ True , それ以外は False|
|排他的論理和|XOR|A XOR B |A が０の場合のみ B が True , B が０の場合のみ A が True , それ以外は False|

<a id="anchor8"></a>

## 8. データ型
 - **どの種類のデータであるかを必ず指定します。**
 - **文字列や日付時刻はシングルクオートやダブルクオートで囲みます。**

    |種類|データ型|書き方|
    |---|---|---|
    |文字列|CHAR,VARCHAR,TEXT|'A' , "abc123" , "あいうえお"|
    |整数|INT,TINYINT|123 , 123456|
    |実数(小数)|DOUBLE,FLOAT,DECIMAL|3.14 , 1.00|
    |日付時刻|DATE,DATETIME|'2021-01-01' , '2022/01/01'|
    |ブール型|BOOLEAN|1 ( True ) , 0 ( FALSE )|
    |緯度経度|GEOMETRY|'POINT ( 139.721251 35.689607 )'|

<a id="anchor9"></a>

## 9. データの型変換 ( CAST )
 - データの型を変換することを **キャスト** と呼びます。

    ```:書式
    CAST( 変換するデータ AS 変換するデータ型 )
    ```

<a id="anchor10"></a>

## 10. グループ化 ( GROUP BY )
 - グループ化とは **複数のレコードをグループごとにまとめること** です。
 - **NULL** も１つのグループとしてグループ化されます。
 - **GROUP BY** 句が存在する場合 **SELECT** 句で書けるのは集約キーのカラム名のみです。<br>**集約キー** ：グループ化するカラム名
 - **SELECT** 文で１つのグループに対する結果は１行となります。
 - **WHERE** 句が存在する場合は、先に実施されたあと、グループ化されます。

    ```:書式
    SELECT カラム名
    FROM テーブル名
    GROUP BY カラム名;
    ```

 - グループそのものへの条件指定<br>**WHERE** 句ではレコードすべてに対しての条件指定になります。<br>**HAVING** 句を使用します。

<a id="anchor11"></a>

## 11. 並び替え ( ORDER BY )
 - 並び替えを行うことを**ソート**と呼びます。
 - **ASC : 昇順 , DESC : 降順**<br>並び順は省略した場合 **ASC** 昇順になります。<br>**同着の場合の順序は決まっていません。**
 - **AS** で別名を付けたカラム名を指定できます。

    ```:書式
    SELECT カラム名
    FROM テーブル名
    ORDER BY カラム名 並び順;
    ```

<a id="anchor12"></a>

## 12. 行数指定 ( LIMIT )
 - SELECT 句の最後に書きます。

    ```:書式
    SELECT カラム名
    FROM テーブル名
    ORDER BY カラム名 並び順
    LIMIT ( 開始位置 ) 行数 ;
    ```

<a id="anchor13"></a>

## 13. 条件 ( CASE )
 - **IF ( 条件 , Trueの際の値 , Falseの際の値 )** でも同じようなことが可能です。
 - 条件は上から順に判定していき、最初にマッチした条件で処理を行います。
 - **ELSE** は省略できます。

    ```:書式
    SELECT カラム名
    CASE
      WHEN 条件１ THEN 処理１
      WHEN 条件２ THEN 処理２
      ELSE 処理０
    END (AS 別名)
    FROM テーブル名
    ```

<a id="anchor14"></a>

## 14. 関数
 - 関数を書く際は**関数名と括弧の間にスペースを入れてはいけません。**

    ```:書式
    〇 COUNT(*)
    ✕ COUNT (*)
    ```

 - **集約関数を SELECT 句に書いたら、値を１つ返すものでしか同時に書けません。**<br>集計関数 : 対象となるデータを計算・集約して１つの結果を返す関数です。

    ```:書式
    SELECT カラム名
    FROM テーブル名
    GROUP BY カラム名
    HAVING 条件;
    ```

<a id="anchor15"></a>

## 15. 重複の削除 ( DISTINCT )
 - カラムは複数指定できます。

    ```:書式
    SELECT DISTINCT カラム FROM テーブル ;
    ```

<a id="anchor16"></a>

## 16. 問い合わせ
 - SELECT の中に書いた別の SELECT を**副問い合わせ**と呼びます。
 - 副問い合わせに対して、一番外側にある SELECT 文を**主問い合わせ**と呼びます。
 - **副問い合わせ部分は主問い合わせ部分より先に実行されます。**
 - 副問い合わせ部分は括弧で囲って書きます。<br>副問い合わせの括弧内の最後にセミコロン **;** は付けません。

    ```:書式
    SELECT カラム名 FROM テーブル名
      WHERE カラム名 演算子 (SELECT ~ ) ;
    ```

### 副問い合わせの結果から NULL を除外する場合

 ```:書式
 SELECT カラム名 FROM テーブル名
   WHERE カラム名 IN
     (SELECT カラム名 FROM テーブル名
         WHERE カラム名 IS NOT NULL ) ;
 ```

### 副問い合わせの複数結果
 - 結果が複数レコードを返す副問い合わせを **複数行問い合わせ** と呼びます。

    |演算子|書き方|意味|
    |----|----|----|
    |IN| A IN 副問い合わせ|A が副問い合わせのいずれかに一致すれば True|
    |NOT IN| A NOT IN 副問い合わせ|A が副問い合わせのいずれかに一致しなければ True|
    |ANY| A 演算子 ANY 副問い合わせ|副問い合わせの結果のいずれかと A との演算結果のいずれかが True であれば True|
    |ALL| A ALL 副問い合わせ|副問い合わせの結果全てと A との演算結果が True であれば True|

### 相関副問い合わせ
 - **副問い合わせの中で主問い合わせの値を参照する副問い合わせのことです。**

    ```:書式
    SELECT カラム名 FROM テーブルA
      WHERE 値　演算子
        (SELECT カラム名 FROM テーブルB
            WHERE テーブルA.カラムC = テーブルB.カラムC ) ;
    ```

    ```:書式
    SELECT カラム名,
      (SELECT カラム名 FROM テーブルB
            WHERE テーブルA.カラムC = テーブルB.カラムC )
    FROM テーブルA ;
    ```

<a id="anchor17"></a>

## 17. テーブルの結合

### UNION
 - テーブルを縦につなぐことができます。
 - 条件として、**お互いのカラムの内容が同じものである必要があります。**
 - テーブル同士のカラム名が異なる場合は、１番最初のテーブルのカラム名になります。
 - 重複を削除して結合を行ので、重複を許可する場合は **UNION ALL** を使用します。
 - 各テーブルに対して処理や関数を使用したい場合は括弧を使用します。

    ```:書式
    SELECT * FROM テーブルA
    UNION
    SELECT * FROM テーブルB ;
    ```

    ```:書式
    SELECT * FROM テーブルA
    UNION ALL
    (SELECT * FROM テーブルB LIMIT 2) ;
    ```

### JOIN ( INSERT JOIN )
 - テーブルを横につなぐことができます。<br>**正確には、テーブルの１レコードずつ、テーブルの中で条件にマッチしたものを結合します。**
 - ON 句にテーブルを結合するための条件を書きます。
 - JOIN は **INSERT JOIN** の省略形です。

    ```:書式
    FROM テーブルA
    JOIN テーブルB
    ON テーブルA.カラムC = テーブルB.カラムC ;
    ```

#### 内部結合：
 - テーブル B の条件にマッチしないテーブ A のレコードは対象外

    ```:書式
    FROM テーブルA
    INSERT JOIN テーブルB
    ON 条件 ;
    ```

#### 外部結合
 - 優先するテーブルを指定して、もう片方に結合条件に当てはまらないレコードがあれば NULL を結合
 - **LEFT JOIN**
 - **RIGHT JOIN**
 - テーブル A を優先する場合

    ```:書式
    FROM テーブルA
    LEFT JOIN テーブルB
    ON テーブルA.カラムC = テーブルB.カラムC ;
    ```

 - テーブル B を優先する場合

    ```:書式
    FROM テーブルA
    RIGHT JOIN テーブルB
    ON テーブルA.カラムC = テーブルB.カラムC ;
    ```
